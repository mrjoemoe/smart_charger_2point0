TMS320C2000 COFF Assembler PC v4.1.0 Thu Nov 05 21:37:38 2009

Tools Copyright (c) 1996-2005 Texas Instruments Incorporated
INVERTER_control.asm                                                 PAGE    1

       1                      .include "single_inverter.inc"
       2              
       3        0000  NET_DEBUG       .set    0       ; do not change this
       4              
       5        0000  IB1             .set    0       ; Open loop INVERTER drive to excite power stage
       6        0001  IB4             .set    1       ; 全部功能
       7                              
       8                                      .def    _control_run_init
       9                                      .def    _control_run
      10              
      11              
      12 00000000       ZeroNet         .usect "Net_terminals",8,1,1
      13 00000008       DummyNet        .usect "Net_terminals",7,1,1
      14              
      15 00000000                               .text
      16              
      17 00000000       _control_run_init:
      18              
      19                                      .if(IB1)
      20                                              ;HRFULLBDG_BIPOLAR_DRV_INIT
      21                                              ;ADC2CONT_DRV_INIT
      22                                      .endif ; IB1
      23              
      24                                      .if(IB4)
      25 00000000                                       ADC2CONT_DRV_INIT
1                     ;==========================
1                     ; Variable Definitions
1        00000000       _ADC2CH_Rslt            .usect "ADC2CH_CONT_DRV_Data",2,1,1             ; Output Terminal 1
1                     
1                     ;Publish Terminal Pointers for access from the C environment (optional)
1                     ;======================================================================
1                                                             .def    _ADC2CH_Rslt
1                     
1                                     ; actual macro code starts here
1                                     ; set terminal to point to ZeroNet
1        00000000 8D80-                         MOVL    XAR2, #DummyNet
         00000001 0008 
1        00000002 761F-                         MOVW    DP, #_ADC2CH_Rslt
         00000003 0000 
1        00000004 AA00-                         MOVL    @_ADC2CH_Rslt, XAR2
      26                                              ;HRFULLBDG_BIPOLAR_DRV_INIT
      27                                      .endif ; IB4
      28 00000005 0006                                  LRETR
      29              
      30 00000006       _control_run:   CONTEXT_SAVE                            ;call macro     
1        00000006 0005                          PUSH AR1H:AR0H ; 32-bit
1        00000007 AABD                          PUSH XAR2 ; 32-bit
1        00000008 A2BD                          PUSH XAR3 ; 32-bit
1        00000009 A8BD                          PUSH XAR4 ; 32-bit
1        0000000a A0BD                          PUSH XAR5 ; 32-bit
1        0000000b C2BD                          PUSH XAR6 ; 32-bit
1        0000000c C3BD                          PUSH XAR7 ; 32-bit
1        0000000d ABBD                          PUSH XT ; 32-bit
      31              
      32              ;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
TMS320C2000 COFF Assembler PC v4.1.0 Thu Nov 05 21:37:38 2009

Tools Copyright (c) 1996-2005 Texas Instruments Incorporated
INVERTER_control.asm                                                 PAGE    2

      33              ;                       IB1
      34              ;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
      35                                      .if(IB1)
      36                                              .ref    _duty                   
      37                                              MOVL    XAR3,#CMPA1             
      38                                              MOVL    XAR4,#CMPA2
      39                                              ; Outputs for EPWM1A and EPWM2A (Hi Res)                
      40                                              SETC    SXM,OVM
      41                                              MOVW    DP,             #_duty
      42                                              MOV             ACC,    @_duty+0
      43                                              MOV     *XAR3,  ACC                             ; CMP1A:CMPAHR1(31:8) = ACC
      44                              MOV             ACC,    @_duty+1
      45                              MOV     *XAR4,  ACC              ; CMP2A:CMPAHR2(31:8) = ACC
      46                                              
      47                                              ;SINGEN_1CH     
      48                                              .ref    _sindata
      49                                              .ref    _sin_length
      50                                              .ref    _Vref
      51                                              .ref    _N
      52                                              MOVW    DP,     #_sin_length
      53                                              MOVL    XAR0,   #_sin_length    ;查表值
      54                                              MOVL    XAR1,   #_N
      55                                              MOVL    XAR2,   #_Vref                  ;出口地址
      56                                              MOVL    XAR3,   #(_sindata+0)           ;XAR3->SINTAB_360
      57                      ;IB2
      58                                              MOV             ACC,    *XAR0
      59                                              ADD     ACC,    #1      
      60                                              MOV             *XAR0,  ACC
      61                                              SUB             ACC,    @_N     
      62                                              BF              LOOP1,  LT
      63                                              MOV             *XAR0,  #0
      64              
      65              LOOP1:                  MOVL    XAR1,   @_sin_length
      66                                              MOV     ACC,    *+XAR3[AR1]             ;取表        
      67                                              MOVL    *XAR2,  ACC                             ;输出
      68                                              
      69                                              .ref    _period
      70                                              .ref    _period1
      71                                              .ref    _period2
      72                                              ; Outputs for EPWM1A and EPWM2A (Hi Res)                
      73                                              MOVW    DP, #_period
      74                                              MOV     T,*XAR2
      75                                              MPY     ACC,T,@_period          ; ACC = Duty*TBPRD*m  (Q15) , max<=(TBPRD-2*T
      76                                      ADD     ACC,@_period2<<15       ; ACC = Duty*TBPRD + TBPRD  (Q15)
      77                                              MOVW    DP,             #_duty
      78                                              MOV     @_duty+0,       AH                              ; CMP1A:CMPAHR1(31:8)
      79                              
      80                              MOVW    DP, #_period1
      81                              MOV     T,*XAR2
      82                                              MPY             ACC,T,@_period1
      83                                              MOVW    DP, #_period                    ; ACC = -1*Duty*TBPRD*m  (Q15) , max<
      84                              ADD             ACC,@_period2<<15
      85                                              MOVW    DP,             #_duty
      86                              MOV     @_duty+1,       AH              ; CMP2A:CMPAHR2(31:8) = ACC
      87                          
TMS320C2000 COFF Assembler PC v4.1.0 Thu Nov 05 21:37:38 2009

Tools Copyright (c) 1996-2005 Texas Instruments Incorporated
INVERTER_control.asm                                                 PAGE    3

      88                                      .endif ; IB1
      89              
      90              ;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
      91              ;@@@@@                 IB4                                      @@@@@@
      92              ;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
      93                                      .if(IB4)
      94              ;=======================================================
      95              ;输出PWM                        
      96                                              .ref    _duty
      97                                                              
      98 0000000e 8DC0                                  MOVL    XAR3,#CMPA1             
         0000000f 6809 
      99 00000010 8F00                                  MOVL    XAR4,#CMPA2
         00000011 6849 
     100                                              ; Outputs for EPWM1A and EPWM2A (Hi Res)                
     101 00000012 3B03                                  SETC    SXM,OVM
     102 00000013 761F!                                 MOVW    DP,             #_duty
         00000014 0000 
     103 00000015 8500!                                 MOV             ACC,    @_duty+0
     104 00000016 96C3                                  MOV     *XAR3,  ACC                             ; CMP1A:CMPAHR1(31:8) = ACC
     105 00000017 8501!                 MOV             ACC,    @_duty+1
     106 00000018 96C4                  MOV     *XAR4,  ACC                                     ; CMP2A:CMPAHR2(31:8) = ACC
     107              ;IB4
     108              ;=======================================================
     109              ;读取ADC采样输出                                                                
     110 00000019                                       ADC2CONT_DRV                                    ;ADC采样
1                     ;=========================
1                     ; uses PF0 (0WS mem)
1        00000019 761F-                         MOVW    DP, #_ADC2CH_Rslt
         0000001a 0000 
1        0000001b 8A00-                         MOVL    XAR4,@_ADC2CH_Rslt              ; XAR4: pointer to Net Bus
1                     
1        0000001c 761F                          MOVW    DP,#ADCPF0R0>>6
         0000001d 002C 
1        0000001e 8D80                          MOVL    XAR2,#ADCPF0R0                  ; XAR2: pointer to ADC buffer regs
         0000001f 0B00 
1                     
1                     ; Read Result0 (1st conversion)
1        00000020 8582                          MOV     ACC,*XAR2++
1        00000021 9684                          MOV     *XAR4++,AL                              ; Q12 format, Unipolar input
1                     
1                     ; Read Result1 (2nd conversion)         
1        00000022 8582                          MOV     ACC,*XAR2++
1        00000023 9684                          MOV     *XAR4++,AL                              ; Q12 format, Unipolar input
1                     
1                     ; Read Result1 (2nd conversion)         
1        00000024 8582                          MOV     ACC,*XAR2++
1        00000025 9684                          MOV     *XAR4++,AL                              ; Q12 format, Unipolar input
     111              
     112              ;IB4
     113              ;=======================================================
     114              ;save voc, iLc, iRc, voc_delay, iRc_delay
     115              
     116                                              .ref    _AdcResults
     117                                              .ref    _ADC
TMS320C2000 COFF Assembler PC v4.1.0 Thu Nov 05 21:37:38 2009

Tools Copyright (c) 1996-2005 Texas Instruments Incorporated
INVERTER_control.asm                                                 PAGE    4

     118                                              .ref    _ADML 
     119                                              .ref    _AdcOffset
     120                                              .ref    _OLRG
     121 00000026 761F!                                 MOVW    DP, #_AdcOffset
         00000027 0000 
     122 00000028 8D00!                                 MOVL    XAR0, #_AdcOffset               ;Q28 format, Unipolar input
         00000029 0000 
     123 0000002a 761F!                         MOVW    DP, #_AdcResults
         0000002b 0000 
     124 0000002c 9A00                          MOV             AL, #0
     125 0000002d 9300!                                 MOV             AH, @_AdcResults+0              ;Q28
     126 0000002e 03C0                                  SUBL    ACC, *XAR0                              ;减去直流电流偏置
     127 0000002f 761F!                                 MOVW    DP, #_ADC
         00000030 0000 
     128 00000031 1E00!                                 MOVL    @_ADC+0, ACC                    ;Q28    voc
     129              
     130 00000032 1EAC                                  MOVL    XT, ACC 
     131                                      
     132 00000033 761F!                         MOVW    DP, #_AdcResults
         00000034 0000 
     133 00000035 9A00                          MOV             AL, #0  
     134 00000036 9301!                                 MOV             AH, @_AdcResults+1              ;Q28
     135 00000037 03C0                                  SUBL    ACC, *XAR0                              ;减去直流电流偏置            
     136 00000038 761F!                                 MOVW    DP,     #_ADC
         00000039 0000 
     137 0000003a 1E02!                                 MOVL    @_ADC+2, ACC                    ;Q28    iLc
     138                                              
     139 0000003b 761F!                                 MOVW    DP, #_AdcResults
         0000003c 0000 
     140 0000003d 9A00                          MOV             AL, #0  
     141 0000003e 9302!                                 MOV             AH, @_AdcResults+2              ;Q28
     142 0000003f 761F!                                 MOVW    DP,     #_ADC
         00000040 0000 
     143 00000041 1E04!                                 MOVL    @_ADC+4, ACC                    ;Q28    iRc     
     144 00000042 06C0                                  MOVL    ACC, *XAR0                              ;减去直流电流偏置
     145 00000043 761F!                                 MOVW    DP,     #_ADC
         00000044 0000 
     146 00000045 0304!                                 SUBL    ACC, @_ADC+4
     147 00000046 1E04!                                 MOVL    @_ADC+4, ACC                    ;Q28    iRc
     148                                              
     149 00000047 5667!                                 QMPYL   P, XT, @_ADC+4                  ;Q28*Q28=Q56-->Q24
         00000048 0004 
     150 00000049 06AB                                  MOVL    ACC, @P
     151 0000004a 761F!                                 MOVW    DP,     #_ADML
         0000004b 0000 
     152 0000004c 1E00!                                 MOVL    @_ADML+0, ACC                   ;Q24    vo*iR
     153              ;IB4
     154              ;-------------------------------------------------------
     155              ;overload protection                            
     156 0000004d 761F!                                 MOVW    DP,     #_ADML
         0000004e 0000 
     157 0000004f 0600!                                 MOVL    ACC, @_ADML+0                   ;Q24    vo*iR
     158 00000050 761F!                                 MOVW    DP,     #_OLRG
         00000051 0000 
     159 00000052 0600!                                 MOVL    ACC, @_OLRG                             ;Q24
TMS320C2000 COFF Assembler PC v4.1.0 Thu Nov 05 21:37:38 2009

Tools Copyright (c) 1996-2005 Texas Instruments Incorporated
INVERTER_control.asm                                                 PAGE    5

     160 00000053 5640                                  ADDCL   ACC, @P                                 ;Q24
         00000054 00AB 
     161 00000055 1E00!                                 MOVL    @_OLRG, ACC                             ;Q24
     162              
     163                                              .ref    _sin_length
     164                                              .ref    _NNN
     165 00000056 761F!                                 MOVW    DP, #_sin_length
         00000057 0000 
     166 00000058 8500!                                 MOV             ACC, @_sin_length
     167 00000059 1900                                  SUB             ACC,    #0              
     168 0000005a ED17                                  BF              exitol, NEQ
     169                                              
     170 0000005b 761F!                                 MOVW    DP,     #_OLRG
         0000005c 0000 
     171 0000005d 8700!                                 MOVL    XT, @_OLRG                              ;Q24
     172 0000005e 9B00                                  MOV             AH, #0
     173 0000005f 9A00                                  MOV             AL, #0
     174 00000060 1E00!                                 MOVL    @_OLRG, ACC
     175 00000061 761F!                                 MOVW    DP,     #_NNN                           ;Q25
         00000062 0000 
     176 00000063 5663!                                 QMPYL   ACC, XT, @_NNN                  ;Q24*Q25=Q49-->Q17
         00000064 0000 
     177              
     178                                              .ref    _POWER
     179 00000065 761F!                                 MOVW    DP, #_POWER
         00000066 0000 
     180 00000067 0300!                                 SUBL    ACC, @_POWER                    ;Q17
     181 00000068 56C4                                  BF              exitol, LT
         00000069 0009 
     182              ;protect###############################
     183 0000006a 7622                                  EALLOW 
     184 0000006b 8D40                                  MOVL    XAR1, #TZFRC1
         0000006c 6818 
     185 0000006d 28C1                                  MOV             *XAR1, #0x6     
         0000006e 0006 
     186 0000006f 0011                                  INTR    INT2    
     187 00000070 761A                                  EDIS                            
     188              ;protect###############################                                                                      
     189 00000071       exitol:
     190              
     191              ;IB4
     192              ;-------------------------------------------------------
     193              ;vo, iR 100 delay
     194              
     195                                              .ref    _vodata
     196                                              .ref    _iRdata
     197                                              .ref    _vo_length
     198              
     199 00000071 761F!                                 MOVW    DP,     #_vo_length
         00000072 0000 
     200 00000073 8D00!                                 MOVL    XAR0,   #_vo_length                     ;查表值
         00000074 0000 
     201 00000075 761F!                                 MOVW    DP,     #_AdcOffset
         00000076 0000 
     202 00000077 8D80!                                 MOVL    XAR2,   #_AdcOffset                     ;Q28 format, Unipolar input
TMS320C2000 COFF Assembler PC v4.1.0 Thu Nov 05 21:37:38 2009

Tools Copyright (c) 1996-2005 Texas Instruments Incorporated
INVERTER_control.asm                                                 PAGE    6

         00000078 0000 
     203 00000079 761F!                                 MOVW    DP,     #_vodata
         0000007a 0000 
     204 0000007b 8DC0!                                 MOVL    XAR3,   #(_vodata+0)            ;XAR3->SINTAB_360
         0000007c 0000 
     205 0000007d 761F!                                 MOVW    DP,     #_iRdata
         0000007e 0000 
     206 0000007f 8F00!                                 MOVL    XAR4,   #(_iRdata+0)            ;XAR4->SINTAB_360
         00000080 0000 
     207              
     208 00000081 85C0                                  MOV             ACC,    *XAR0
     209 00000082 0901                                  ADD     ACC,    #1      
     210 00000083 96C0                                  MOV             *XAR0,  ACC
     211 00000084 1964                                  SUB             ACC,    #100    
     212 00000085 56C4                                  BF              LOOPQ,  LT
         00000086 0003 
     213 00000087 2BC0                                  MOV             *XAR0,  #0
     214              
     215 00000088       LOOPQ:                  
     216 00000088 761F!                                 MOVW    DP,     #_vo_length
         00000089 0000 
     217 0000008a 8B00!                                 MOVL    XAR1,   @_vo_length
     218                              ;               MOVW    DP,     #_vodata        
     219 0000008b 939B                                  MOV     AH,     *+XAR3[AR1]                             ;取表        
     220 0000008c 9A00                          MOV             AL, #0  
     221 0000008d 03C2                                  SUBL    ACC, *XAR2                                      ;减去直流电流偏置
     222 0000008e 761F!                                 MOVW    DP,     #_ADC
         0000008f 0000 
     223 00000090 1E06!                                 MOVL    @_ADC+6, ACC                            ;Q28 vo_delay
     224              
     225 00000091 761F!                         MOVW    DP, #_AdcResults
         00000092 0000 
     226 00000093 8500!                                 MOV             ACC, @_AdcResults+0                     ;Q12
     227                              ;               MOVW    DP,     #_vodata
     228 00000094 969B                                  MOV             *+XAR3[AR1], ACC                        ;save voc
     229              
     230                              ;               MOVW    DP,     #_iRdata
     231 00000095 939C                                  MOV     AH,     *+XAR4[AR1]                             ;取表
     232 00000096 9A00                          MOV             AL, #0 
     233 00000097 761F!                                 MOVW    DP,     #_ADC
         00000098 0000 
     234 00000099 1E08!                                 MOVL    @_ADC+8, ACC                    ;Q28    iRc     
     235 0000009a 06C2                                  MOVL    ACC, *XAR2                              ;减去直流电流偏置
     236 0000009b 761F!                                 MOVW    DP,     #_ADC
         0000009c 0000 
     237 0000009d 0308!                                 SUBL    ACC, @_ADC+8
     238 0000009e 1E08!                                 MOVL    @_ADC+8, ACC                    ;Q28    iRc
     239              
     240 0000009f 761F!                         MOVW    DP, #_AdcResults
         000000a0 0000 
     241 000000a1 8502!                                 MOV             ACC, @_AdcResults+2                     ;Q12
     242                              ;               MOVW    DP,     #_iRdata
     243 000000a2 969C                                  MOV             *+XAR4[AR1], ACC                        ;save iRc
     244              
     245              ;IB4
TMS320C2000 COFF Assembler PC v4.1.0 Thu Nov 05 21:37:38 2009

Tools Copyright (c) 1996-2005 Texas Instruments Incorporated
INVERTER_control.asm                                                 PAGE    7

     246              ;-------------------------------------------------------
     247              ;
     248                                              
     249                                              .ref    _pq
     250 000000a3 761F!                                 MOVW    DP,     #_ADML
         000000a4 0000 
     251 000000a5 0600!                                 MOVL    ACC, @_ADML+0                   ;Q24    vo*iR 
     252 000000a6 761F!                                 MOVW    DP,     #_ADC                           
         000000a7 0000 
     253 000000a8 8706!                                 MOVL    XT, @_ADC+6                             ;Q28    vo_delay
     254 000000a9 5667!                                 QMPYL   P, XT, @_ADC+8                  ;Q28*Q28=Q56-->Q24
         000000aa 0008 
     255                                                                                                              ;vo_delay*iR_
     256 000000ab 5640                                  ADDCL   ACC,    @P                              ;Q24
         000000ac 00AB 
     257 000000ad 5680                                  ASR64   ACC:P, #1                               ;Q24
     258 000000ae 761F!                                 MOVW    DP,     #_pq                            
         000000af 0000 
     259 000000b0 1E00!                                 MOVL    @_pq+0, ACC                             ;Q24
     260              
     261 000000b1 761F!                                 MOVW    DP,     #_ADC                           
         000000b2 0000 
     262 000000b3 8700!                                 MOVL    XT, @_ADC+0                             ;Q28    vo
     263 000000b4 5667!                                 QMPYL   P, XT, @_ADC+8                  ;Q28*Q28=Q56-->Q24
         000000b5 0008 
     264                                                                                                              ;vo*iR_delay
     265 000000b6 06AB                                  MOVL    ACC, @P
     266 000000b7 8704!                                 MOVL    XT, @_ADC+4                             ;Q28    iR
     267 000000b8 5667!                                 QMPYL   P, XT, @_ADC+6                  ;Q28*Q28=Q56-->Q24
         000000b9 0006 
     268                                              
     269                                                                                                              ;iR*vo_delay 
     270              
     271 000000ba 07AB                                  ADDL   ACC,    @P                               ;Q24
     272 000000bb 5680                                  ASR64   ACC:P, #1                               ;Q24
     273 000000bc 761F!                                 MOVW    DP,     #_pq                            
         000000bd 0000 
     274 000000be 1E02!                                 MOVL    @_pq+2, ACC                             ;Q24
     275              
     276              ;IB4
     277              ;=======================================================
     278              ;PQ caculation 
     279              
     280              ;@@@@@                  P  LPF
     281              ;Uo(n)=1.58*wc*Ts*Ui(n)+Uo(n-1)/(1+wc*Ts)
     282              ;         =tl1*Ui(n)+tl*Uo(n-1)
     283                                              .ref    _terg
     284                                              .ref    _tlp
     285                                              .ref    _tlp1
     286                                              .ref    _tlq
     287                                              .ref    _tlq1
     288              
     289 000000bf 761F!                                 MOVW    DP,     #_pq
         000000c0 0000 
     290 000000c1 8700!                                 MOVL    XT, @_pq+0              ;Q24
TMS320C2000 COFF Assembler PC v4.1.0 Thu Nov 05 21:37:38 2009

Tools Copyright (c) 1996-2005 Texas Instruments Incorporated
INVERTER_control.asm                                                 PAGE    8

     291 000000c2 761F!                                 MOVW    DP,     #_tlp1                  ;Q29
         000000c3 0000 
     292 000000c4 5667!                                 QMPYL   P,      XT,     @_tlp1          ;Ui(n)*tl1 Q24*Q29=Q53-->Q21
         000000c5 0000 
     293 000000c6 06AB                                  MOVL    ACC, @P                         ;Q21
     294              
     295 000000c7 761F!                                 MOVW    DP,     #_terg
         000000c8 0000 
     296 000000c9 8700!                                 MOVL    XT,     @_terg+0                ;load U(n-1) Q28
     297 000000ca 761F!                                 MOVW    DP,     #_tlp                   ;Q25
         000000cb 0000 
     298 000000cc 5667!                                 QMPYL   P,      XT,     @_tlp           ;E(n)*ks Q28*Q25=Q53-->Q21
         000000cd 0000 
     299 000000ce 5640                                  ADDCL   ACC,    @P                      ;Q21
         000000cf 00AB 
     300              
     301                                              .ref    _LPFulimit
     302                                              .ref    _LPFllimit
     303 000000d0 761F!                                 MOVW    DP,     #_LPFulimit     ;
         000000d1 0000 
     304 000000d2 7680!                                 MOVL    XAR6,   #_LPFulimit     ;Q21    
         000000d3 0000 
     305 000000d4 76C0!                                 MOVL    XAR7,   #_LPFllimit     ;Q21
         000000d5 0000 
     306 000000d6 5650                                  MINL    ACC, *XAR6                              
         000000d7 00C6 
     307 000000d8 5661                                  MAXL    ACC, *XAR7  
         000000d9 00C7 
     308                                              
     309 000000da FF36                                  LSL             ACC, #7                         ;Q21+7-->Q28
     310              
     311 000000db 761F!                                 MOVW    DP,     #_terg
         000000dc 0000 
     312 000000dd 1E00!                                 MOVL    @_terg+0,   ACC         ;Q28
     313                                              
     314              ;IB4
     315 000000de 761F!                                 MOVW    DP,     #_ADC
         000000df 0000 
     316 000000e0 8706!                                 MOVL    XT, @_ADC+6                             ;vo_delay
     317 000000e1 5667!                                 QMPYL   P,      XT,     @_ADC+4                 ;vo_dealy*iR Q28*Q28=Q56-->Q2
         000000e2 0004 
     318 000000e3 06AB                                  MOVL    ACC, @P
     319 000000e4 761F!                                 MOVW    DP,     #_ADML
         000000e5 0000 
     320 000000e6 1E02!                                 MOVL    @_ADML+2, ACC
     321              
     322              ;IB4
     323              ;@@@@@                  Q  LPF
     324              ;Uo(n)=1.58*wc*Ts*Ui(n)+Uo(n-1)/(1+wc*Ts)
     325              ;         =tl1*Ui(n)+tl*Uo(n-1)
     326                                              
     327 000000e7 761F!                                 MOVW    DP,     #_pq
         000000e8 0000 
     328 000000e9 8702!                                 MOVL    XT, @_pq+2              ;Q24
     329 000000ea 761F!                                 MOVW    DP,     #_tlq1                  ;Q29
TMS320C2000 COFF Assembler PC v4.1.0 Thu Nov 05 21:37:38 2009

Tools Copyright (c) 1996-2005 Texas Instruments Incorporated
INVERTER_control.asm                                                 PAGE    9

         000000eb 0000 
     330 000000ec 5667!                                 QMPYL   P,      XT,     @_tlq1          ;Ui(n)*tl1 Q24*Q29=Q53-->Q21
         000000ed 0000 
     331 000000ee 06AB                                  MOVL    ACC, @P                         ;Q21
     332              
     333 000000ef 761F!                                 MOVW    DP,     #_terg
         000000f0 0000 
     334 000000f1 8702!                                 MOVL    XT,     @_terg+2                ;load U(n-1) Q28
     335 000000f2 761F!                                 MOVW    DP,     #_tlq                   ;Q25
         000000f3 0000 
     336 000000f4 5667!                                 QMPYL   P,      XT,     @_tlq           ;E(n)*ks Q28*Q25=Q53-->Q21
         000000f5 0000 
     337 000000f6 5640                                  ADDCL   ACC,    @P                      ;Q21
         000000f7 00AB 
     338              
     339                                              .ref    _LPFulimit
     340                                              .ref    _LPFllimit
     341 000000f8 761F!                                 MOVW    DP,     #_LPFulimit     ;
         000000f9 0000 
     342 000000fa 7680!                                 MOVL    XAR6,   #_LPFulimit     ;Q21    
         000000fb 0000 
     343 000000fc 76C0!                                 MOVL    XAR7,   #_LPFllimit     ;Q21
         000000fd 0000 
     344 000000fe 5650                                  MINL    ACC, *XAR6                              
         000000ff 00C6 
     345 00000100 5661                                  MAXL    ACC, *XAR7  
         00000101 00C7 
     346                                              
     347 00000102 FF36                                  LSL             ACC, #7                         ;Q21+7-->Q28
     348              
     349 00000103 761F!                                 MOVW    DP,     #_terg
         00000104 0000 
     350 00000105 1E02!                                 MOVL    @_terg+2,   ACC         ;Q28
     351              ;IB4
     352              ;=======================================================
     353              ;caculate the feedback of voltage and current
     354 00000106       exit:           
     355                                              .ref    _kcv
     356                                              .ref    _kci
     357                                              .ref    _FDrg
     358 00000106 761F!                                 MOVW    DP,     #_kcv                           ;Q19
         00000107 0000 
     359 00000108 8700!                                 MOVL    XT, @_kcv
     360 00000109 761F!                                 MOVW    DP, #_ADC
         0000010a 0000 
     361 0000010b 5663!                                 QMPYL   ACC, XT, @_ADC+0                ;Q19+Q28=Q47-->Q15，vo*kcv
         0000010c 0000 
     362 0000010d 761F!                                 MOVW    DP, #_FDrg
         0000010e 0000 
     363 0000010f 0700!                                 ADDL    ACC,    @_FDrg+0
     364 00000110 5680                                  ASR64   ACC:P,  #1                              
     365 00000111 1E00!                                 MOVL    @_FDrg+0, ACC                   ;Q15
     366              ;IB4
     367 00000112 761F!                                 MOVW    DP,     #_kci                           ;Q19
         00000113 0000 
TMS320C2000 COFF Assembler PC v4.1.0 Thu Nov 05 21:37:38 2009

Tools Copyright (c) 1996-2005 Texas Instruments Incorporated
INVERTER_control.asm                                                 PAGE   10

     368 00000114 8700!                                 MOVL    XT, @_kci
     369 00000115 761F!                                 MOVW    DP, #_ADC
         00000116 0000 
     370 00000117 5663!                                 QMPYL   ACC, XT, @_ADC+2                ;Q26+Q28=Q54-->Q22，iL*kci
         00000118 0002 
     371 00000119 761F!                                 MOVW    DP, #_FDrg
         0000011a 0000 
     372 0000011b 1E02!                                 MOVL    @_FDrg+2, ACC                   ;Q22
     373              
     374              ;IB4
     375              ;=======================================================
     376              ;调用正弦表 
     377                                              ;SINGEN_1CH     
     378                                              .ref    _sindata
     379                                              .ref    _Vref
     380                                              .ref    _N
     381 0000011c 761F!                                 MOVW    DP,     #_sin_length
         0000011d 0000 
     382 0000011e 8D00!                                 MOVL    XAR0,   #_sin_length    ;查表值
         0000011f 0000 
     383 00000120 8D40!                                 MOVL    XAR1,   #_N
         00000121 0000 
     384 00000122 8D80!                                 MOVL    XAR2,   #_Vref                  ;出口地址
         00000123 0000 
     385 00000124 8DC0!                                 MOVL    XAR3,   #(_sindata+0)           ;XAR3->SINTAB_360
         00000125 0000 
     386              ;IB4
     387 00000126 85C0                                  MOV             ACC,    *XAR0
     388 00000127 0901                                  ADD     ACC,    #1      
     389 00000128 96C0                                  MOV             *XAR0,  ACC
     390 00000129 AEC1                                  SUB             ACC,    *XAR1   
     391 0000012a 56C4                                  BF              LOOP1,  LT
         0000012b 0003 
     392 0000012c 2BC0                                  MOV             *XAR0,  #0
     393              
     394 0000012d 8B00! LOOP1:                  MOVL    XAR1,   @_sin_length
     395 0000012e 859B                                  MOV     ACC,    *+XAR3[AR1]             ;取表        
     396 0000012f 1EC2                                  MOVL    *XAR2,  ACC                             ;输出
     397              
     398              ;IB4
     399              ;=======================================================
     400              ;DQ method
     401              ;V=Vr-nq*Q
     402                                              .ref    _mpp
     403                                              .ref    _nqq
     404                                              .ref    _Wref
     405                                              .ref    _W
     406                                              .ref    _NUM
     407                                              .ref    _Pw
     408                                              .ref    _V
     409                                              .ref    _Vr
     410 00000130 761F!                                 MOVW    DP,     #_terg
         00000131 0000 
     411 00000132 8702!                                 MOVL    XT,     @_terg+2                        ;Q28
     412                              ;///////////////////////////            
TMS320C2000 COFF Assembler PC v4.1.0 Thu Nov 05 21:37:38 2009

Tools Copyright (c) 1996-2005 Texas Instruments Incorporated
INVERTER_control.asm                                                 PAGE   11

     413                              ;               MOV             AH, #0x0099
     414                              ;               MOV             AL, #0x1AA2
     415                              ;               MOVL    XT, ACC
     416                              ;///////////////////////////
     417                                              
     418 00000133 761F!                                 MOVW    DP,     #_V
         00000134 0000 
     419 00000135 0600!                                 MOVL    ACC, @_V                                ;Q16
     420 00000136 761F!                                 MOVW    DP, #_nqq                               ;Q20
         00000137 0000 
     421 00000138 5667!                                 QMPYL   P, XT, @_nqq                    ;Q28+Q20=Q48-->Q16
         00000139 0000 
     422 0000013a 03AB                                  SUBL    ACC, @P                                 ;Q16
     423 0000013b 761F!                                 MOVW    DP,     #_Vr
         0000013c 0000 
     424 0000013d 1E00!                                 MOVL    @_Vr, ACC                               ;Q16
     425                                              
     426 0000013e 761F!                                 MOVW    DP,     #_Vref
         0000013f 0000 
     427 00000140 9A00                                  MOV             AL, #0
     428 00000141 9300!                                 MOV             AH, @_Vref                              ;Q31
     429              
     430 00000142 1EAC                                  MOVL    XT, ACC                         
     431 00000143 761F!                                 MOVW    DP,     #_Vr                            ;Q16
         00000144 0000 
     432 00000145 5667!                                 QMPYL   P, XT, @_Vr                             ;Q16+Q31=Q47-->Q15
         00000146 0000 
     433 00000147 06AB                                  MOVL    ACC, @P
     434 00000148 761F!                                 MOVW    DP,     #_Vref
         00000149 0000 
     435 0000014a 1E00!                                 MOVL    @_Vref, ACC
     436              
     437              ;-------------------------------------------------------
     438              ;w=wr-mp*P
     439 0000014b 761F!                                 MOVW    DP,     #_terg
         0000014c 0000 
     440 0000014d 8700!                                 MOVL    XT,     @_terg+0                        ;Q28
     441                                              
     442                              ;///////////////////////////            
     443                              ;               MOV             AH, #0x0099
     444                              ;               MOV             AL, #0x1AA2
     445                              ;               MOVL    XT, ACC
     446                              ;///////////////////////////
     447              
     448 0000014e 761F!                                 MOVW    DP,     #_Wref                          
         0000014f 0000 
     449 00000150 0600!                                 MOVL    ACC, @_Wref                             ;Q14
     450 00000151 761F!                                 MOVW    DP, #_mpp                               ;Q18
         00000152 0000 
     451 00000153 5667!                                 QMPYL   P, XT, @_mpp                    ;Q28+Q18=Q46-->Q14
         00000154 0000 
     452 00000155 03AB                                  SUBL    ACC, @P                                 ;Q14
     453                                              
     454 00000156 761F!                                 MOVW    DP,     #_W
         00000157 0000 
TMS320C2000 COFF Assembler PC v4.1.0 Thu Nov 05 21:37:38 2009

Tools Copyright (c) 1996-2005 Texas Instruments Incorporated
INVERTER_control.asm                                                 PAGE   12

     455 00000158 1E00!                                 MOVL    @_W, ACC                                ;Q14
     456              ;division               
     457 00000159 0200                                  MOVB    ACC, #0
     458 0000015a 761F!                                 MOVW    DP,     #_NUM                           ;Q14
         0000015b 0000 
     459 0000015c A300!                                 MOVL    P, @_NUM                                
     460 0000015d 761F!                                 MOVW    DP,     #_W
         0000015e 0000 
     461 0000015f F61F                                  RPT             #31
     462 00000160 5617!                         ||SUBCUL        ACC, @_W                                ;Q14
         00000161 0000 
     463 00000162 761F!                                 MOVW    DP,     #_Pw    
         00000163 0000 
     464 00000164 A900!                                 MOVL    @_Pw, P                                 ;Q14-Q14=Q0
     465 00000165 0600!                                 MOVL    ACC,@_Pw                                        
     466              
     467 00000166 8D80                                  MOVL    XAR2, #TBPRD1
         00000167 6805 
     468 00000168 8DC0                                  MOVL    XAR3, #TBPRD2
         00000169 6845 
     469 0000016a 8F00                                  MOVL    XAR4, #TBPRD6
         0000016b 6945 
     470 0000016c 96C2                                  MOV             *XAR2, ACC
     471 0000016d 96C3                                  MOV             *XAR3, ACC
     472 0000016e 96C4                                  MOV             *XAR4, ACC
     473                                              
     474                                              .ref    _period
     475                                              .ref    _period1
     476 0000016f 761F!                                 MOVW    DP, #_period
         00000170 0000 
     477 00000171 9600!                                 MOV             @_period, ACC
     478 00000172 9B00                                  MOV             AH, #0
     479 00000173 9A00                                  MOV             AL, #0
     480 00000174 AE00!                                 SUB             ACC, @_period
     481 00000175 761F!                                 MOVW    DP, #_period1
         00000176 0000 
     482 00000177 9600!                                 MOV             @_period1, ACC  
     483              
     484              ;IB4
     485              ;=======================================================
     486              ;电压PI环 
     487              ;V(n)=V(n-1)+(Kp+Ki)*e(n)-Kp*e(n-1)  TI=1/KI
     488 00000178 761F!                                 MOVW    DP,  #_Vref
         00000179 0000 
     489 0000017a 0600!                                 MOVL    ACC, @_Vref      ;Q15
     490 0000017b 761F!                                 MOVW    DP,  #_FDrg
         0000017c 0000 
     491 0000017d 0700!                                 ADDL    ACC, @_FDrg+0           ;E(N)Q15
     492              
     493                                              .ref    _Eupperlimit
     494                                              .ref    _Elowerlimit
     495 0000017e 761F!                                 MOVW    DP,     #_Eupperlimit   ;
         0000017f 0000 
     496 00000180 7680!                                 MOVL    XAR6,   #_Eupperlimit   ;Q15    
         00000181 0000 
TMS320C2000 COFF Assembler PC v4.1.0 Thu Nov 05 21:37:38 2009

Tools Copyright (c) 1996-2005 Texas Instruments Incorporated
INVERTER_control.asm                                                 PAGE   13

     497 00000182 76C0!                                 MOVL    XAR7,   #_Elowerlimit   ;Q15
         00000183 0000 
     498 00000184 5650                                  MINL    ACC, *XAR6                              
         00000185 00C6 
     499 00000186 5661                                  MAXL    ACC, *XAR7  
         00000187 00C7 
     500              
     501 00000188 96AC                                  MOV             T,      ACC
     502 00000189 34AC                                  MPY             ACC,T,#0x2000                   ;Q15+13=Q28
         0000018a 2000 
     503              ;IB4
     504                                              .ref    _temp
     505                                              .ref    _kp
     506                                              .ref    _kp1
     507                                              .ref    _ks
     508                                              
     509 0000018b 3B03                                  SETC    SXM,OVM
     510 0000018c 761F!                                 MOVW    DP,  #_temp
         0000018d 0000 
     511 0000018e 1E02!                                 MOVL    @_temp+2,       ACC                     ;save E(n) Q28
     512 0000018f 0604!                                 MOVL    ACC,    @_temp+4                ;Vo(n-1)        Q22
     513 00000190 8702!                                 MOVL    XT,             @_temp+2                ;load E(n) Q28
     514 00000191 761F!                                 MOVW    DP,  #_ks
         00000192 0000 
     515 00000193 5667!                                 QMPYL   P,      XT,     @_ks                    ;E(n)*ks Q28*Q26=Q54-->Q22   
         00000194 0000 
     516 00000195 5640                                  ADDCL   ACC,    @P                              ;ACC=ACC+P+carry
         00000196 00AB 
     517              
     518 00000197 8700!                                 MOVL    XT,             @_temp+0                ;E(n-1)         Q28
     519 00000198 761F!                                 MOVW    DP,  #_kp1
         00000199 0000 
     520 0000019a 5667!                                 QMPYL   P,      XT,     @_kp1                   ;E(n-1)*Kp      Q28*Q26=Q54--
         0000019b 0000 
     521 0000019c 5640                                  ADDCL   ACC,    @P                              ;Q22 E(n)*ks+Vo(n-1)-E(n-1)*k
         0000019d 00AB 
     522              ;IB4                            
     523                                              .ref    _upperlimit
     524                                              .ref    _lowerlimit
     525 0000019e 761F!                                 MOVW    DP,     #_upperlimit    ;
         0000019f 0000 
     526 000001a0 7680!                                 MOVL    XAR6,   #_upperlimit    ;Q22    
         000001a1 0000 
     527 000001a2 76C0!                                 MOVL    XAR7,   #_lowerlimit    ;Q22
         000001a3 0000 
     528 000001a4 5650                                  MINL    ACC, *XAR6                              
         000001a5 00C6 
     529 000001a6 5661                                  MAXL    ACC, *XAR7
         000001a7 00C7 
     530              
     531                                              .ref    _Iref
     532 000001a8 761F!                                 MOVW    DP,  #_Iref
         000001a9 0000 
     533 000001aa 8D40!                                 MOVL    XAR1,   #_Iref                  ;Q22
         000001ab 0000 
TMS320C2000 COFF Assembler PC v4.1.0 Thu Nov 05 21:37:38 2009

Tools Copyright (c) 1996-2005 Texas Instruments Incorporated
INVERTER_control.asm                                                 PAGE   14

     534 000001ac 761F!                                 MOVW    DP,  #_temp
         000001ad 0000 
     535 000001ae 1E04!                                 MOVL    @_temp+4, ACC                   ;SAVE next Vo(n-1) Q22
     536 000001af 1EC1                                  MOVL    *XAR1, ACC                              ;Q22 Iref=Vo(n)
     537 000001b0 0602!                                 MOVL    ACC,    @_temp+2                ;Q28 load E(n)
     538 000001b1 1E00!                                 MOVL    @_temp+0,       ACC                     ;Q28 save E(n-1)
     539              ;IB4
     540              ;=======================================================
     541              ;电流环                                 
     542                                              .ref    _kpi
     543 000001b2 761F!                                 MOVW    DP,     #_FDrg                          ;
         000001b3 0000 
     544 000001b4 06C1                                  MOVL    ACC,    *XAR1                   ;Q22
     545 000001b5 0702!                                 ADDL    ACC,    @_FDrg+2                ;Q22    
     546 000001b6 1EAC                                  MOVL    XT,     ACC                                     ;Q22
     547 000001b7 761F!                                 MOVW    DP,     #_kpi                           ;kpi,q25
         000001b8 0000 
     548 000001b9 5663!                                 QMPYL   ACC,XT,@_kpi                    ;Q25+22=Q47->Q15
         000001ba 0000 
     549                                              
     550                                              .ref    _iupperlimit
     551                                              .ref    _ilowerlimit
     552 000001bb 761F!                                 MOVW    DP,     #_iupperlimit   ;
         000001bc 0000 
     553 000001bd 7680!                                 MOVL    XAR6,   #_iupperlimit   ;Q15    
         000001be 0000 
     554 000001bf 76C0!                                 MOVL    XAR7,   #_ilowerlimit   ;Q15
         000001c0 0000 
     555 000001c1 5650                                  MINL    ACC, *XAR6                              
         000001c2 00C6 
     556 000001c3 5661                                  MAXL    ACC, *XAR7
         000001c4 00C7 
     557 000001c5 1EC1                                  MOVL    *XAR1, ACC      
     558              ;IB4
     559              ;=======================================================
     560              ;软启动
     561                                              .ref    _M
     562              
     563 000001c6 761F!                                 MOVW    DP,     #_sin_length
         000001c7 0000 
     564 000001c8 8D00!                                 MOVL    XAR0,   #_sin_length    ;查表值
         000001c9 0000 
     565 000001ca 8D40!                                 MOVL    XAR1,   #_Iref
         000001cb 0000 
     566 000001cc 8D80!                                 MOVL    XAR2,   #_M
         000001cd 0000 
     567 000001ce 8DC0                                  MOVL    XAR3,   #GPASET
         000001cf 6FC2 
     568                                                                                      
     569              ;if M=128,then jump to loop3
     570 000001d0 85C2                                  MOV             ACC,    *XAR2
     571 000001d1 1980                                  SUB             ACC,    #128            
     572 000001d2 EC36                                  BF              loop3,  EQ
     573              ;if M>128,then jump to loop4
     574 000001d3 85C2                                  MOV             ACC,    *XAR2
TMS320C2000 COFF Assembler PC v4.1.0 Thu Nov 05 21:37:38 2009

Tools Copyright (c) 1996-2005 Texas Instruments Incorporated
INVERTER_control.asm                                                 PAGE   15

     575 000001d4 1981                                  SUB             ACC,    #129
     576 000001d5 EC45                                  BF              loop4,  EQ
     577                                              ;M<128:
     578              ;if sin_length=0,then M++,else jump to loop2
     579 000001d6 85C0                                  MOV             ACC,    *XAR0
     580 000001d7 1900                                  SUB             ACC,    #0              
     581 000001d8 ED04                                  BF              loop2,  NEQ
     582                                              ;M++                            
     583 000001d9 85C2                                  MOV             ACC,    *XAR2
     584 000001da 0901                                  ADD     ACC,    #1                                      
     585 000001db 96C2                                  MOV             *XAR2,  ACC
     586              ;PI output=Vo,let Vo=(Vo*M)/128
     587 000001dc       loop2:                  
     588              ;=======================================================
     589 000001dc 2DC1                                  MOV     T,      *XAR1                           ;Q15
     590 000001dd 1200!                                 MPY     ACC,    T,      @_M                     ;Q15*Q0-->Q15
     591 000001de 5686                          ASR64   ACC:P,  #7                              ;1/128,Q15      
     592 000001df 1EC1                                  MOVL    *XAR1, ACC                              ;Q15
     593              ;-------------------------------------------------------
     594                                              .ref    _CFLAG
     595                                              .ref    _i
     596 000001e0 761F!                                 MOVW    DP,             #_sin_length                            
         000001e1 0000 
     597 000001e2 8F00                                  MOVL    XAR4,   #GPADAT
         000001e3 6FC0 
     598 000001e4 DC01                                  ADDB    XAR4,   #1
     599 000001e5 8F40!                                 MOVL    XAR5,   #_sin_length
         000001e6 0000 
     600              
     601 000001e7 85C4                                  MOV             ACC,    *XAR4                           ;读取I/O口的电平
     602 000001e8 3E00                                  AND             ACC,    #0x0200                         ;屏蔽其他I/O口
         000001e9 0200 
     603 000001ea 761F!                                 MOVW    DP,     #_i
         000001eb 0000 
     604 000001ec 9600!                                 MOV             @_i,    ACC                                     ;save output 
     605              ;if SYNC=0,then jump to loopc
     606 000001ed 1900                                  SUB             ACC,    #0
     607 000001ee EC05                                  BF              loopc,  EQ                                      
     608              ;SYNC=1
     609 000001ef B700!                                 XOR             ACC,    @_CFLAG                         ;ACC=SYNC XOR CFLAG
     610              ;if ACC!=0,then jump to SETCN,else exit. 
     611 000001f0 1900                                  SUB             ACC,    #0                                      
     612 000001f1 ED0B                                  BF              SETCN,  NEQ
     613 000001f2 6F15                                  LB              exit1
     614              ;IB4
     615              ;SYNC=0
     616 000001f3       loopc:                                          
     617 000001f3 761F!                                 MOVW    DP,     #_i
         000001f4 0000 
     618 000001f5 8500!                                 MOV             ACC,    @_i
     619 000001f6 761F!                                 MOVW    DP,     #_CFLAG
         000001f7 0000 
     620 000001f8 B700!                                 XOR             ACC,    @_CFLAG                         ;ACC=SYNC XOR CFLAG  
     621              ;if ACC!=0,then jump to SETCC,else exit.
     622 000001f9 1900                                  SUB             ACC,    #0
TMS320C2000 COFF Assembler PC v4.1.0 Thu Nov 05 21:37:38 2009

Tools Copyright (c) 1996-2005 Texas Instruments Incorporated
INVERTER_control.asm                                                 PAGE   16

     623 000001fa ED09                                  BF              SETCC,  NEQ
     624 000001fb 6F0C                                  LB              exit1                           
     625              ;STCN:reset N,let N=0x0014 and set CFLAG.
     626 000001fc       SETCN:
     627 000001fc 28C5                                  MOV             *XAR5,  #0x0397                 ;20 is delay time
         000001fd 0397 
     628 000001fe 761F!                                 MOVW    DP,     #_CFLAG
         000001ff 0000 
     629 00000200 2800!                                 MOV             @_CFLAG,#0x0200
         00000201 0200 
     630 00000202 6F05                                  LB              exit1                                   ;exit   
     631              ;SETCC:reset CFLAG,let CFLAG=0;
     632 00000203       SETCC:                  
     633 00000203 761F!                                 MOVW    DP,     #_CFLAG
         00000204 0000 
     634 00000205 2B00!                                 MOV             @_CFLAG,#0x0000 
     635 00000206 6F01                                  LB              exit1                                   ;exit
     636                                              
     637 00000207       exit1:  
     638              ;-------------------------------------------------------
     639 00000207 6F13                                  LB              loop4
     640              ;=======================================================
     641 00000208       loop3:
     642 00000208 DB01                                  ADDB    XAR3,   #1
     643 00000209 28C3                                  MOVW    *XAR3,  #0x00000020
         0000020a 0020 
     644              
     645 0000020b 85C2                                  MOV             ACC,    *XAR2
     646 0000020c 0901                                  ADD     ACC,    #1                                      
     647 0000020d 96C2                                  MOV             *XAR2,  ACC
     648                                              
     649                                              .ref    _mp
     650                                              .ref    _nq
     651 0000020e 761F!                                 MOVW    DP, #_mp                                ;Q18
         0000020f 0000 
     652 00000210 0600!                                 MOVL    ACC, @_mp
     653 00000211 761F!                                 MOVW    DP, #_mpp                               ;Q18
         00000212 0000 
     654 00000213 1E00!                                 MOVL    @_mpp, ACC                              
     655                                              
     656 00000214 761F!                                 MOVW    DP, #_nq                                ;Q20
         00000215 0000 
     657 00000216 0600!                                 MOVL    ACC, @_nq
     658 00000217 761F!                                 MOVW    DP, #_nqq                               ;Q20
         00000218 0000 
     659 00000219 1E00!                                 MOVL    @_nqq, ACC      
     660                                                                              
     661 0000021a       loop4:
     662              
     663              ;IB4
     664              ;=======================================================
     665              ;计算PWM涑觯保存在duty0,duty1
     666              
     667                                              ; Outputs for EPWM1A and EPWM2A (Hi Res)                
     668 0000021a 761F!                                 MOVW    DP, #_period
TMS320C2000 COFF Assembler PC v4.1.0 Thu Nov 05 21:37:38 2009

Tools Copyright (c) 1996-2005 Texas Instruments Incorporated
INVERTER_control.asm                                                 PAGE   17

         0000021b 0000 
     669 0000021c 8D40!                                 MOVL    XAR1,   #_Iref
         0000021d 0000 
     670 0000021e 2DC1                                  MOV     T,*XAR1
     671 0000021f 1200!                                 MPY     ACC,T,@_period          ; ACC = Duty*TBPRD*m  (Q15) , max<=(TBPRD-2*T
     672 00000220 5604!                         ADD     ACC,@_period<<15        ; ACC = Duty*TBPRD + TBPRD  (Q15)
         00000221 0F00 
     673 00000222 761F!                                 MOVW    DP,             #_duty
         00000223 0000 
     674 00000224 9700!                                 MOV     @_duty+0,       AH                              ; CMP1A:CMPAHR1(31:8)
     675                              
     676 00000225 761F!                 MOVW    DP, #_period1
         00000226 0000 
     677 00000227 2DC1                  MOV     T,*XAR1
     678 00000228 1200!                                 MPY             ACC,T,@_period1
     679 00000229 761F!                                 MOVW    DP, #_period                    ; ACC = -1*Duty*TBPRD*m  (Q15) , max<
         0000022a 0000 
     680 0000022b 5604!                 ADD             ACC,@_period<<15
         0000022c 0F00 
     681 0000022d 761F!                                 MOVW    DP,             #_duty
         0000022e 0000 
     682 0000022f 9701!                 MOV     @_duty+1,       AH              ; CMP2A:CMPAHR2(31:8) = ACC
     683              ;IB4                    
     684                                      .endif ; IB4
     685              
     686              
     687              ;===================================
     688 00000230       EXIT_ISR
     689              ;===================================
     690              ; Interrupt management before exit
     691              
     692 00000230 761F                          MOVW    DP,#ETCLR1>>6
         00000231 01A0 
     693 00000232 281C                          MOV     @ETCLR1,#0x01                   ; Clear EPWM1 Int flag
         00000233 0001 
     694              
     695 00000234 761F                          MOVW    DP,#PIEACK>>6                   ; Acknowledge PIE interrupt Group 3
         00000235 0033 
     696 00000236 2821                          MOV     @PIEACK,#PIEACK_GROUP3
         00000237 0004 
     697              
     698 00000238 761F                          MOVW    DP,#ADCST>>6
         00000239 01C4 
     699 0000023a 2819                          MOV     @ADCST,#0x010                   ; Clear INT SEQ1 Int flag
         0000023b 0010 
     700              
     701 0000023c 761F                          MOVW    DP,#PIEACK>>6                   ; Acknowledge PIE interrupt Group 1
         0000023d 0033 
     702 0000023e 2821                          MOV     @PIEACK,#PIEACK_GROUP1
         0000023f 0001 
     703              ; Restore context & return
     704 00000240                               CONTEXT_REST
1        00000240 87BE                          POP XT
1        00000241 C5BE                          POP XAR7
1        00000242 C4BE                          POP XAR6
TMS320C2000 COFF Assembler PC v4.1.0 Thu Nov 05 21:37:38 2009

Tools Copyright (c) 1996-2005 Texas Instruments Incorporated
INVERTER_control.asm                                                 PAGE   18

1        00000243 83BE                          POP XAR5
1        00000244 8ABE                          POP XAR4
1        00000245 82BE                          POP XAR3
1        00000246 86BE                          POP XAR2
1        00000247 0003                          POP AR1H:AR0H
     705 00000248 7602                          IRET            
     706              
     707              ;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
     708              ;@@@@@@@                                the     END                       @@@@@@@
     709              ;@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@               

No Assembly Errors, No Assembly Warnings
